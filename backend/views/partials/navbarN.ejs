
<header>
  <div class="nav_bar">
  <img class="logo_image" id="light-logo" src="/img/light-logoDeeDev.svg" alt="Light Logo">
  <img class="logo_image" id="dark-logo" src="/img/logoDeeDev.svg" alt="Dark Logo" style="display: none;">

  <nav id='nav4Large'>
    <ul>
      <li>
        <a href="/">
          <i class="fas fa-home"></i>Home
        </a>
      </li>
      <li>
        <a href="/#aboutSection">
          <i class="fas fa-user"></i>About
        </a>
      </li>
      <li>
        <a href="/#servicesSection">
          <i class="fas fa-clone"></i>Services
        </a>
      </li>
      <li>
        <a href="/#testimonial">
          <i class="fas fa-comment"></i>Testimonial
        </a>
      </li>
      <li>
        <a href="/#contactSection">
          <i class="fas fa-phone"></i>Contact
        </a>
      </li>
      <li class="blog" onclick="toggleBlogMenu(event)">
        <a href="#">
          Blog
          <span class="toggle-icon">+</span>
        </a>
        <ul class="blog-menu">
          <li>
            <a href="/blogs">Home</a>
          </li>
          <li class='write-review'>
            <a href="/posts/new">Write blog</a>
          </li>
        </ul>
      </li>
      <% if(!isAuthenticated) {%>
        <li id="loggedIn">
          <a href="/auth/login">
            <i class="fas fa-sign-in-alt"></i>Sign In
          </a>
        </li>
        <li id="reg">
          <a href="/auth/newuser">
            <i class="fas fa-user-plus"></i>Sign Up
          </a>
        </li>
        <% } else{ %>
          <li id="loggedOut">
            <a href="/auth/logout">
              <i class="fas fa-sign-out-alt"></i>Sign Out
            </a>
          </li>
          <li class="profileImage">
            <a href="/auth/profile">
              <img href="#" src="<%- user.image %>" alt="" style="width:40px; border-radius: 100%;" />
            </a>
          </li>
          <% } %>
    </ul>
  </nav>

  <nav id='accordion' class='dropdown'>
    <input
      type='checkbox'
      id='toggle-01'
      class='toggle burger-toggle'
      hidden
    >
    <label for='toggle-01' class='toggle-button'>
      <div class='burger'>
        <div class='line1'></div>
        <div class='line2'></div>
        <div class='line3'></div>
      </div>
    </label>
    
    <ul class='dropdown-menu lvl-1'>
      <li class='item'><a><i class='bi bi-house-fill'></i> Home</a></li>
      <li class='item'><a>About</a></li>
      <li class='dropdown'>
        <input type='checkbox' id='toggle-02' class='toggle' hidden>
        <label for='toggle-02' class='toggle-button caret'><i class='bi bi-image'></i> Gallery </label>
        <ul class='dropdown-menu lvl-2'>
          <li class='dropdown'>
            <input type='checkbox' id='toggle-03' class='toggle' hidden>
            <label for='toggle-03' class='toggle-button caret'>3D Graphics </label>
            <ul class='dropdown-menu lvl-3'>
              <li class='item'><a>Characters</a></li>
              <li class='item'><a>Landscapes</a></li>
            </ul>
          </li>
          <li class='item'><a>2D Illustration</a></li>
        </ul>
      </li>
      <li class='dropdown'>
        <input type='checkbox' id='toggle-04' class='toggle' hidden>
        <label for='toggle-04' class='toggle-button caret'><i class='bi bi-code-slash'></i> Web Development </label>
        <ul class='dropdown-menu lvl-2'>
          <li class='item'><a>Articles</a></li>
          <li class='dropdown'>
            <input type='checkbox' id='toggle-05' class='toggle' hidden>
            <label for='toggle-05' class='toggle-button caret'>Projects </label>
            <ul class='dropdown-menu lvl-3'>
              <li class='item'><a>JS</a></li>
              <li class='item'><a>CSS</a></li>
            </ul>
          </li>
          <li class='item'><a>Tutorials</a></li>
        </ul>
      </li>
      <li class='item'><a><i class='bi bi-envelope-fill'></i> Contact</a></li>
    </ul>
  </nav>
  
  <button class="toggle-btn">
    <i class="far fa-moon"></i>
    <i class="far fa-sun"></i>
  </button>

  <!-- <div class="hamburger-menu">
    <div class="bar"></div>
  </div> -->
</div>
</header>
<script>

function toggleBlogMenu(event) {  
    const blog = event.currentTarget;
    // const blogMenu = blog.nextElementSibling;
    const blogMenu = document.querySelector('.blog-menu');
    const toggleIcon = blog.querySelector(".toggle-icon");
    console.log('toggleBlogMenu==', toggleIcon);
    if (blogMenu.style.maxHeight) {
        blogMenu.style.maxHeight = null;
    } else {
        blogMenu.style.maxHeight = blogMenu.scrollHeight + "px";
    }

    toggleIcon.classList.toggle("open");
    toggleIcon.textContent = blogMenu.style.maxHeight ? "-" : "+";
}
</script>


<!-- <nav id='accordion' class='dropdown'>
  <input
    type='checkbox'
    id='toggle-01'
    class='toggle burger-toggle'
    hidden
  >
  <label for='toggle-01' class='toggle-button'>
    <div class='burger'>
      <div class='line1'></div>
      <div class='line2'></div>
      <div class='line3'></div>
    </div>
  </label>
  
  <ul class='dropdown-menu lvl-1'>
    <li class='item'><a><i class='bi bi-house-fill'></i> Home</a></li>
    <li class='item'><a>About</a></li>
    <li class='dropdown'>
      <input type='checkbox' id='toggle-02' class='toggle' hidden>
      <label for='toggle-02' class='toggle-button caret'><i class='bi bi-image'></i> Gallery </label>
      <ul class='dropdown-menu lvl-2'>
        <li class='dropdown'>
          <input type='checkbox' id='toggle-03' class='toggle' hidden>
          <label for='toggle-03' class='toggle-button caret'>3D Graphics </label>
          <ul class='dropdown-menu lvl-3'>
            <li class='item'><a>Characters</a></li>
            <li class='item'><a>Landscapes</a></li>
          </ul>
        </li>
        <li class='item'><a>2D Illustration</a></li>
      </ul>
    </li>
    <li class='dropdown'>
      <input type='checkbox' id='toggle-04' class='toggle' hidden>
      <label for='toggle-04' class='toggle-button caret'><i class='bi bi-code-slash'></i> Web Development </label>
      <ul class='dropdown-menu lvl-2'>
        <li class='item'><a>Articles</a></li>
        <li class='dropdown'>
          <input type='checkbox' id='toggle-05' class='toggle' hidden>
          <label for='toggle-05' class='toggle-button caret'>Projects </label>
          <ul class='dropdown-menu lvl-3'>
            <li class='item'><a>JS</a></li>
            <li class='item'><a>CSS</a></li>
          </ul>
        </li>
        <li class='item'><a>Tutorials</a></li>
      </ul>
    </li>
    <li class='item'><a><i class='bi bi-envelope-fill'></i> Contact</a></li>
  </ul>
</nav> -->

<script>
  window.CP.PenTimer.MAX_TIME_IN_LOOP_WO_EXIT = 6000;

// searches next siblings for a target element
const findNextSibling = (elem, selector) => {
  while (elem !== null) {
    elem = elem.nextElementSibling
    if (elem.matches(selector)) return elem
  }
  return elem
}

// if unable to toggle between a and b or b and a
// will return false
const toggleBetween = (elem, a, b) => {
  return elem.classList.replace(a, b) || elem.classList.replace(b, a)
}

// A recursive function to set the total height of an open dropdown
// based on the heights of its child elements
const calcHeights = function (elems) {
  let height = 0
  
  // argument for first call will be a single root element
  // recursive calls will be children
  if (elems instanceof Element) elems = [elems]

  for (const elem of elems) {
    
    // only include calculations for opened dropdowns
    if (elem.matches('.dropdown, .open')) {
      const parentHeight = calcHeights(elem.children)

      if (elem.matches('.open')) {
        elem.style.setProperty('--calc-height', parentHeight + 'px')
      }

      height += parentHeight     
    } else {
      // getBoundingClientRect gives a more accurate height
      const elemHeight = elem.getBoundingClientRect().height
      
      height += (elem.matches('.closed')) ? 0 : elemHeight
    }
  }
  return height
}

const toggleMenu = (dropdown, rootElem) => { 
  if (!toggleBetween(dropdown, 'open', 'closed')) {
    // first time clicking on this dropdown
    dropdown.classList.add('open')
  }
  calcHeights(rootElem)
}

window.addEventListener('DOMContentLoaded', () => {
  const rootElem = document.querySelector('#accordion .dropdown-menu')
  
  // change --calc-height from auto to 0 for initial transition
  document
    .documentElement
    .style.setProperty('--calc-height', '0px')
  
  document
    .querySelectorAll('#accordion .toggle')
    .forEach((toggle) => {
      const dropdown = findNextSibling(toggle, '.dropdown-menu')
      
      toggle.addEventListener('click', (event) => {
        toggleMenu(dropdown, rootElem)
      })
    })
  
    document.querySelector('#toggle-01').click()
})
</script>